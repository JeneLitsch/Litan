global x = 1337;
global str;
global arr;
global value_str = "ABC";
global value_int = 42;

namespace foo {
	global x;
	namespace bar {
		global x;

		function get_x()         => global ::x 
		function get_foo_x()     => global ::foo::x
		function get_foo_bar_x() => global x
		function get_bar_x()     => global ::bar::x
	}

	function get_x()         => global ::x 
	function get_foo_x()     => global x
	function get_foo_bar_x() => global bar::x
	function get_bar_x()     => global ::bar::x
}

namespace bar {
	global x;
}


namespace core {
	function globals(sphinx) {
		sphinx::run_test(sphinx, "Globals default", lambda(fx) => (fx)(), [
			sphinx::assert_result([lambda() => global x           ], 1337),
			sphinx::assert_result([lambda() => global foo::x      ], null),
			sphinx::assert_result([lambda() => global foo::bar::x ], null),
			sphinx::assert_result([lambda() => global bar::x      ], null),
			sphinx::assert_result([&foo::bar::get_x()             ], 1337),
			sphinx::assert_result([&foo::bar::get_foo_x()         ], null),
			sphinx::assert_result([&foo::bar::get_foo_bar_x()     ], null),
			sphinx::assert_result([&foo::bar::get_bar_x()         ], null),
			sphinx::assert_result([&foo::get_x()                  ], 1337),
			sphinx::assert_result([&foo::get_foo_x()              ], null),
			sphinx::assert_result([&foo::get_foo_bar_x()          ], null),
			sphinx::assert_result([&foo::get_bar_x()              ], null),
			sphinx::assert_result([lambda() => global str         ], null),
			sphinx::assert_result([lambda() => global value_int   ], 42),
			sphinx::assert_result([lambda() => global value_str   ], "ABC"),
		]);

		global x = 1;
		global foo::x = 2;
		global foo::bar::x = 3;
		global bar::x = 4;
		global str = "Hello World!";
		global arr = [1,2,3];

		sphinx::run_test(sphinx, "Globals init", lambda(fx) => (fx)(), [
			sphinx::assert_result([lambda() => global x           ], 1),
			sphinx::assert_result([lambda() => global foo::x      ], 2),
			sphinx::assert_result([lambda() => global foo::bar::x ], 3),
			sphinx::assert_result([lambda() => global bar::x      ], 4),
			sphinx::assert_result([&foo::bar::get_x()             ], 1),
			sphinx::assert_result([&foo::bar::get_foo_x()         ], 2),
			sphinx::assert_result([&foo::bar::get_foo_bar_x()     ], 3),
			sphinx::assert_result([&foo::bar::get_bar_x()         ], 4),
			sphinx::assert_result([&foo::get_x()                  ], 1),
			sphinx::assert_result([&foo::get_foo_x()              ], 2),
			sphinx::assert_result([&foo::get_foo_bar_x()          ], 3),
			sphinx::assert_result([&foo::get_bar_x()              ], 4),
			sphinx::assert_result([lambda() => global str         ], "Hello World!"),
			sphinx::assert_result([lambda() => global arr         ], [1,2,3]),
		]);

		global x *= 10;
		global foo::x *= 10;
		global foo::bar::x *= 10;
		global bar::x *= 10;

		sphinx::run_test(sphinx, "Globals x10", lambda(fx) => (fx)(), [
			sphinx::assert_result([lambda() => global x           ], 10),
			sphinx::assert_result([lambda() => global foo::x      ], 20),
			sphinx::assert_result([lambda() => global foo::bar::x ], 30),
			sphinx::assert_result([lambda() => global bar::x      ], 40),
			sphinx::assert_result([&foo::bar::get_x()             ], 10),
			sphinx::assert_result([&foo::bar::get_foo_x()         ], 20),
			sphinx::assert_result([&foo::bar::get_foo_bar_x()     ], 30),
			sphinx::assert_result([&foo::bar::get_bar_x()         ], 40),
			sphinx::assert_result([&foo::get_x()                  ], 10),
			sphinx::assert_result([&foo::get_foo_x()              ], 20),
			sphinx::assert_result([&foo::get_foo_bar_x()          ], 30),
			sphinx::assert_result([&foo::get_bar_x()              ], 40),
		]);

		global x += 1.5;
		global foo::x += 1.5;
		global foo::bar::x += 1.5;
		global bar::x += 1.5;
		global arr += [4] + [5];

		sphinx::run_test(sphinx, "Globals modify add", lambda(fx) => (fx)(), [
			sphinx::assert_result([lambda() => global x           ], 11.5),
			sphinx::assert_result([lambda() => global foo::x      ], 21.5),
			sphinx::assert_result([lambda() => global foo::bar::x ], 31.5),
			sphinx::assert_result([lambda() => global bar::x      ], 41.5),
			sphinx::assert_result([&foo::bar::get_x()             ], 11.5),
			sphinx::assert_result([&foo::bar::get_foo_x()         ], 21.5),
			sphinx::assert_result([&foo::bar::get_foo_bar_x()     ], 31.5),
			sphinx::assert_result([&foo::bar::get_bar_x()         ], 41.5),
			sphinx::assert_result([&foo::get_x()                  ], 11.5),
			sphinx::assert_result([&foo::get_foo_x()              ], 21.5),
			sphinx::assert_result([&foo::get_foo_bar_x()          ], 31.5),
			sphinx::assert_result([&foo::get_bar_x()              ], 41.5),
			sphinx::assert_result([lambda() => global arr         ], [1,2,3,4,5]),
		]);
	}
}