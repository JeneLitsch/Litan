namespace test {
	function make_capture_lambda(a) {
		return lambda [a] () {
			return a;
		};
	}

	function make_capture_lambda(a, b) {
		return lambda [a, b] () {
			return a + b;
		};
	}

	function make_capture_lambda() {
		var a = 1;
		var b = 2;
		return lambda [a, b] (c, d) {
			return a - b + c - d;
		};
	}

	function test_iife(p1) {
		var x = 2;
		var y = -1 * iife {
			var a = --iife{
				return iife {
					var foo = p1;
					return foo;
				} * x;
			};
			return a;
		};
		return iife {
			return y;
		};
	}

	function iifes() {
		var cases = [
			[[-21],  42],
			[[1],    -2],
			[[1337], -2674],
			[[4],    -8],
		];
		return test_all_cases("iife{...}", &test_iife(_), cases);
	}

	function captures() {
		var cases = [
			[[make_capture_lambda(1) , []], 1],
			[[make_capture_lambda(42), []], 42],
			[[make_capture_lambda(21, 21), []], 42],
			[[make_capture_lambda(1000, 337), []], 1337],
			[[make_capture_lambda(), [3, 4]], -2],
			[[make_capture_lambda(), [3, 1]], 1],
		];

		return test_all_cases("Lambda capture", &std::invoke(_,_), cases);
	}

	function functional() {
		return captures() + iifes();
	}
}